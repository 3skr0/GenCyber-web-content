<!--
	Gencyber web content: Day 1. These files are intended to provide step-by-step self paced tutorials to teachers seeking to learn about cybersecurity first principles as part of the UNO Gencyber camp.
	Copyright (C) 2016  Dr. Matthew L. Hale

	This program is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<link rel="stylesheet" title="Monokai Sublime" href="css/monokai-sublime.css">
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		<title>Gencyber Day Two</title>
		<style>
			#unologo{font-size: 1.2em;text-transform:uppercase;font-family:'urwgroteskregular';color:#FFF;display:inline-block;vertical-align:middle;margin-top:10px;margin-left:3px;font-weight:bold;}
			.logo {
				float: left;
				margin-left: 0px;
				margin-top: 5px;
			}

			#tagline{font-size: 1em;font-family:'urwgroteskregular';color:#FFF;display:inline-block;vertical-align:middle;margin-top:15px;margin-left:30px;font-weight:bold;}

			.tagline {
				float: left;
				margin-left: -175px;
				margin-top: 25px;
			}
			#main{
				margin-top: 90px;
				margin-bottom: 50px;
				margin-left: 0px;
				width: 100%;
			}

			pre {padding: 0em;}
			img {
				padding-bottom: 20px;
				padding-top: 10px;
			}
			body {
				font-size: 16px;
				position: relative;
			}

			.copy-stmt {
				margin-right: 20px;
			}
			#leftnav ul {
				position: fixed;
			}
			#leftnav ul li a {
				padding-top: 2px;
				padding-bottom: 2px;

			}
			#taskitem {
				min-height: 1px;
				height: 1000px;
			}
			#scrollable-content {
				position: relative;
				height: 100%;
				overflow-y: scroll;
			}
			:target:before {
				content:"";
				display:block;
				height:90px; /* fixed header height*/
				margin:-90px 0 0; /* negative fixed header height */
			}


		</style>
	</head>
	<body>
		<!-- <nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<img alt="University of Nebraska Omaha" src="images/logo-subsite-o-2.png">
					<p id="unologo">UNO: Techademy</p>
					<p id="tagline">Secure Web Development &copy; 2016 - Dr. Matt Hale</p>
				</div>
			</div>
		</nav> -->
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="row">
					<img alt="University of Nebraska Omaha" src="images/logo-subsite-o-2.png" style="float: left;">
					<div class="row logo">
						<p id="unologo">UNO: Gencyber</p>
					</div>
					<div class="row tagline">
						<p id="tagline">Day Two &copy; 2016 - Dr. Matthew Hale</p>
					</div>
				</div>
			</div>
		</nav>
		<div id="main" class="container">
			<div class="row">
				<nav class="col-sm-1 hidden-xs" id="leftnav">
					<ul class="nav nav-pills nav-stacked">
						<h5>Step:</h5>
						<li><a href="#task1">1</a></li>
						<li><a href="#task2">2</a></li>
						<li><a href="#task3">3</a></li>
						<li><a href="#task4">4</a></li>
						<li><a href="#task5">5</a></li>
						<li><a href="#task6">6</a></li>
						<li><a href="#task7">7</a></li>
						<li><a href="#task8">8</a></li>
						<li><a href="#task9">9</a></li>
						<li><a href="#task10">10</a></li>
						<li><a href="#task11">11</a></li>
						<li><a href="#task12">12</a></li>
						<li><a href="#task13">13</a></li>
						<li><a href="#task14">14</a></li>
						<li><a href="#task15">15</a></li>
						<li><a href="#task16">16</a></li>
						<li><a href="#task17">17</a></li>
						<li><a href="#task18">18</a></li>
						<li><a href="#task19">19</a></li>
						<li><a href="#task20">20</a></li>
						<li><a href="#task21">21</a></li>
						<li><a href="#task22">22</a></li>
					</ul>
				</nav>
				<!--start content -->
				<div class="col-sm-11 col-xs-12" id="scrollable-content" data-spy="scroll" data-target="#leftnav" data-offset="90">
					<div class="jumbotron">
						<h1>Welcome to Gencyber Day 2</h1>
						<p>This guide will get you up and running with Apache, Django, and Django REST framework. You may want to replace 'myapp' with your actually application name below.</p>
						<p><a class="btn btn-primary btn-lg" href="#task1" role="button">Get started</a></p>
					</div>
					<div class="list-group">
						<a href="#task1" class="list-group-item">Unit 1: Installing Apache</a>
					</div>
					<div id="task1" class="taskitem">
						<h3 class="taskitem">1. Installing and running Apache</h3>

			            Open your ubuntu server-vm. Once its booted up, login and then press ctrl+alt+t to open a new terminal <br>
			           	To install apache type the following in the terminal:<br>
			            <pre><code>sudo apt-get update
sudo apt-get install apache2</code></pre><br>
			            <br>
			            You should see: <img src="images/apache-install.png"/><br>

			            Lets run apache and confirm that "It Works!"<br>
			            To do so, restart apache from the command line via:<br>
			            <pre><code>sudo service apache2 restart</code></pre><br>
			            <br>
			            With the server restarted, open your a browser (click chrome icon on the left) and navigate to "localhost" (without quotes)
			            You should see the default configuration running and it should look something like this:<br>
			            <img src="images/apache-it-works.png"/><br>
			            <br>
			            At this point you are hosting a webserver just like you would find almost anywhere online. Pretty simple to start with right? Well at this point apache is just serving a single page called a "static file." You can find this page (the configuration page) in the /var/www/html/ directory using the file browser or command line. Open it up and take a look and you will see the raw html used to make the "It works" page.

					</div><!-- End Task 1-->
					<div id="task2" class="taskitem">
						<h3 class="taskitem">2. Setup your development environment: Installing Django and Forking the starter serverside code</h3>
			            
			            Now that we have a default install of apache ready, lets make our webserver more interesting by installing and configuring a web application framework called "Django" to work with the server. We will start with setting up a development environment. Step 3 will get django setup for production<br>

			            First install Django by typing the following in the command line:<br>
			            <pre><code>sudo apt-get install python-pip
pip install Django==1.9.7</code></pre><br>
			           	Easy enough to install...<br>
			            Next, lets create your first Django app by starting with some basic code I created for you to get going.<br>
						
						Go to <a href="https://github.com/MLHale/gencyberdjango">https://github.com/MLHale/gencyberdjango</a> and fork the repository by clicking the "fork" button in the upper right.<br>
						<img src="images/fork-django-project.png"/><br>

						This should create a copy of the repository that you can control.<br> 
						<img src="images/forked-repo.png"/><br>
						When you are done it should look something like:<br>
						<img src="images/forked-repo2.png"/><br>
						Notice in the red elipse that you now have your own copy of the repo. If you go to "https://github.com/&lt;yourusername&gt;/gencyberdjango" you should see it.<br>
			            Back in your virtual machine, lets get started with this code (we will review what is in there in a moment)<br>
			            (make sure to replace &lt;yourusername&gt; with your actual github username)
			            <pre><code>sudo chown student:www-data -R /var/www/
cd /var/www/
git clone https://github.com/&lt;yourusername&gt;/gencyberdjango gencybersite
cd gencybersite/</code></pre><br>
		            	
			            With this project, you will get a directory structure that looks like
			            <img src="images/django-project-structure.png"/><br>

			            Now that we have Django installed and a project running we should be able to test Django in development mode using a utility called "runserver" that runs a development version of django for you to develop your code with. This utility provides real-time recompilation as you edit python files and keeps your app hosted on localhost:8000. This is helpful for testing purposes. The utility also provides real-time feedback every time you save python files in your django directory. This can help you debug if you make errors along the way. Lets take a look at runserver now:<br>
			            <pre><code>python manage.py runserver</code></pre><br>
			            You should see something that looks like:
			            <img src="images/django-runserver.png"/><br>
			            Now, open up a chrome browser window and navigate to localhost:8000/api/<br>
			            You should see that your django server is running and that there are three types of data served by your api: users, likes, and userprofiles. 
						<img src="images/api-running-in-runserver.png"/><br>
						Lets investigate these data structures using the django admin interface. In your browser go to localhost:8000/admin/ and login using the username/password student/studentgencyber Then, click on like and then on "someflickrphototitle". Also take a look at the userprofile and user models.<br>
						You should see something like: <img src="images/admin-interface.png"/><br>
						then: <img src="images/admin-interface2.png"/><br>
						Then: <img src="images/admin-interface3.png"/><br>

						Feel free to manipulate some fields and click "save"<br>

						Now lets take a look at these items as our application will eventually see them: that is of course, in JSON format (javascript object notation).<br>
						Go to localhost:8000/api/likes and you should see: <br>
						then: <img src="images/api-likes.png"/><br>
			        </div><!-- End Task 2-->
			        <div id="task3" class="taskitem">
			        	<h3 class="taskitem">3. Configuring Django for production</h3>
			        	In the first step we installed apache. In the second, we install django. Notice they are running on different ports (port 80 for apache, i.e. just localhost, and port 8000 for django, i.e. localhost:8000). What we want is to setup apache to actually host django - so that when we make changes to our development enviornment we can 'push' them to production. Usually your production server would be an entirely different system. For the rest of this tutorial, we will just use a seperate folder. Lets get this setup. <br>

			        	First, start by cloning your django repo into a new folder.
			        	<pre><code>cd /var/www/
git clone https://github.com/&lt;yourusername&gt;/gencyberdjango production
cd production</code></pre><br>
						Now you have two copies of django, one for development in /var/www/gencybersite/ and one in /var/www/production/ that you will be letting apache serve. <br>
						Lets get this 'production environment' (a term based in the domain seperation and layering first principles) configured. <br>

						You will need a module called mod_wsgi to allow apache to talk to the django python kernal (a run time environment for python). Lets go ahead and install it:<br>

			            <pre><code>sudo apt-get install libapache2-mod-wsgi</code></pre>
			            This library allows Django to tell apache what to serve at any given time. <br>
			            To make it work, we need to make some changes to our apache configuration file in /etc/apache2/sites-available/ to tell it to host django instead of the default "it works" page that we started with.
			            <br>
			            Lets take a look at our current running apache config: open a new terminal window (ctrl+shift+t in terminal) and type<br>
			            <pre><code>nano /etc/apache2/sites-available/000-default.conf</code></pre><br>
			            Notice that it is hosting the files in /var/www/html/ that we looked at in step 1.<br>
						<img src="images/apache-default-conf.png"/><br>
			            To change it to django lets disable this site and create a new virtualhost setup for django:<br>
			            First, lets create the new virtualhost conf file.
			            <pre><code>sudo nano /etc/apache2/sites-available/django.conf</code></pre>
			            Change it to the following:<br>
			            <pre><code>&lt;VirtualHost *:80&gt;
        ServerName localhost

        ServerAdmin youremail@youremail.edu

        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
        # error, crit, alert, emerg.
        # It is also possible to configure the loglevel for particular
        # modules, e.g.
        LogLevel info

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        Alias /static/ /var/www/production/static
        Alias /favicon.ico /var/www/production/static/icons/favicon.ico
        
        #allow access to static files
        &lt;Directory /var/www/production/static&gt;
            Options -Indexes
            Require all granted
        &lt;/Directory&gt;

        #allow access to wsgi file
        &lt;Directory /var/www/production&gt;
            &lt;Files wsgi.py&gt;
                Require all granted
            &lt;/Files&gt;
        &lt;/Directory&gt;

        ServerSignature Off
&lt;/VirtualHost&gt;
WSGIScriptAlias / /var/www/production/wsgi.py
WSGIPythonPath /var/www/production/</code></pre><br>

			        </div><!-- End Task 3-->
			        <div id="task4" class="taskitem">
			        </div><!-- End Task 4-->
			        <div id="task5" class="taskitem">
			        </div><!-- End Task 5-->
			        <div id="task6" class="taskitem">
			        </div><!-- End Task 6-->
			        <div id="task7" class="taskitem">
			        </div><!-- End Task 7-->
			        <div id="task8" class="taskitem">
			        </div><!-- End Task 8-->
			        <div id="task9" class="taskitem">
			        </div><!-- End Task 9-->
						            
TBD------------------------
			            Since this is a 'production' server, lets set Django up to work with apache through mod_wsgi. <br>

			            <img src="images/lab2/wsgi-file.png"/><br>
			            
			            Now tell apache to talk to django instead of loading the "It works" page<br>
			            <pre><code>sudo nano /etc/apache2/sites-available/000-default.conf</code></pre><br>
			            Change it to the following:<br>
			            <pre><code>&lt;VirtualHost *:80&gt;
        # The ServerName directive sets the request scheme, hostname and port that
        # the server uses to identify itself. This is used when creating
        # redirection URLs. In the context of virtual hosts, the ServerName
        # specifies what hostname must appear in the request's Host: header to
        # match this virtual host. For the default virtual host (this file) this
        # value is not decisive as it is used as a last resort host regardless.
        # However, you must set it for any further virtual host explicitly.
        ServerName iasc8080-08.ist.unomaha.edu

        ServerAdmin mlhale@unomaha.edu

        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
        # error, crit, alert, emerg.
        # It is also possible to configure the loglevel for particular
        # modules, e.g.
        LogLevel info

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        Alias /static/ /var/www/myapp/static/
        Alias /favicon.ico /var/www/myapp/static/icons/favicon.ico
        
        #allow access to static files
        &lt;Directory /var/www/myapp/static&gt;
            Options -Indexes
            Require all granted
        &lt;/Directory&gt;

        #allow access to wsgi file
        &lt;Directory /var/www/myapp&gt;
            &lt;Files wsgi.py&gt;
                Require all granted
            &lt;/Files&gt;
        &lt;/Directory&gt;

        ServerSignature Off

        # For most configuration files from conf-available/, which are
        # enabled or disabled at a global level, it is possible to
        # include a line for only one particular virtual host. For example the
        # following line enables the CGI configuration for this host only
        # after it has been globally disabled with "a2disconf".
        #Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;
WSGIScriptAlias / /var/www/myapp/wsgi.py
WSGIPythonPath /var/www/myapp/
# vim: syntax=apache ts=4 sw=4 sts=4 sr noet</code></pre><br>
			            <br>
			            This virtual host is apache's way of binding certain ports to certain hosted files. In this configuration we are enabling django to run inside of apache using the WSGI interface. The WSGIScriptAlias maps to the wsgi.py file in our django install and the python path points to the directory where our project code is at. This configuration also hosts a static files directory in myapp that can be used to host any static files (like css or js or ...your ember app).<br>
			            Now we just need to do a few things<br>
			            <pre><code>mkdir /var/www/myapp/static
			sudo service apache2 reload
			sudo service apache2 restart</code></pre><br>
			            This will restart the server and load the configuration.<br>
			            If all went well you should see:<br>
			            <img src="images/lab2/django-working2.png"/><br>	
					</div><!-- End of Task 2-->

				</div><!--end scrollable content -->
				<!-- Copyright info -->
				<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">UNO Gencyber Content</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="mlhale.com" property="cc:attributionName" rel="cc:attributionURL">Dr. Matthew L. Hale</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/MLHale/GenCyber-web-content" rel="dct:source">https://github.com/MLHale/GenCyber-web-content</a>.
			</div><!-- end row -->
			
			
			

		</div><!-- end main -->
		<p class="text-muted pull-right copy-stmt">Secure Web Development &copy; 2015 - Dr. Matt Hale</p>
	</body>
</html>